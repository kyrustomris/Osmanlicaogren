<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Osmanlıca Öğren</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lateef&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        /* Temel Stiller */
        .osmanlica-font {
            font-family: 'Lateef', serif;
            font-size: 2.5rem;
            line-height: 1.2;
        }
        
        .transliteration {
            font-style: italic;
            color: #6c757d;
        }
        
        .meaning {
            font-size: 1.2rem;
            margin-top: 1rem;
        }
        
        .word-card {
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .nav-btn {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        /* Temalar */
        .light-theme {
            background-color: #f8f9fa;
            color: #212529;
        }
        
        .dark-theme {
            background-color: #212529;
            color: #f8f9fa;
        }
        
        .dark-theme .card {
            background-color: #2c3034;
            color: #f8f9fa;
        }
        
        .ottoman-theme {
            background-color: #f5f5dc;
            color: #5a3921;
            background-image: url('https://www.transparenttextures.com/patterns/arabesque.png');
        }
        
        .ottoman-theme .card {
            background-color: rgba(245, 245, 220, 0.9);
            border: 1px solid #5a3921;
        }
        
        .ottoman-theme .osmanlica-font {
            color: #8b4513;
        }
        
        /* Sosyal Medya Butonları */
        .social-media-bar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-bottom: 10px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .social-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        
        .support-btn {
            background-color: #6f42c1;
            color: white;
        }
        
        /* Quiz Modal */
        #quizModal .modal-content { 
            min-width: 320px;
        }
        
        #quizModal .quiz-option { 
            min-width: 200px; 
        }
        
        /* Responsive Düzenlemeler */
        @media (max-width: 768px) {
            .osmanlica-font {
                font-size: 2rem;
            }
            
            .nav-btn {
                width: 45px;
                height: 45px;
            }
        }
    </style>
</head>
<body class="light-theme">
    <div class="container py-4">
        <header class="text-center mb-4">
            <h1><i class="bi bi-book"></i> Osmanlıca Öğren</h1>
            <div class="d-flex justify-content-center align-items-center gap-3">
                <div class="theme-switcher btn-group mt-2">
                    <button class="btn btn-sm btn-light theme-btn active" data-theme="light" title="Açık tema">
                        <i class="bi bi-sun-fill"></i>
                    </button>
                    <button class="btn btn-sm btn-dark theme-btn" data-theme="dark" title="Koyu tema">
                        <i class="bi bi-moon-fill"></i>
                    </button>
                    <button class="btn btn-sm btn-warning theme-btn" data-theme="ottoman" title="Osmanlı teması">
                        <i class="bi bi-palette-fill"></i>
                    </button>
                </div>
                <span id="premiumBadge" class="badge bg-warning text-dark mt-2 d-none">
                    <i class="bi bi-star-fill"></i> Premium
                </span>
            </div>
        </header>

        <div id="auth-section" class="mx-auto mb-4" style="padding:1em; border:1px solid #ccc; max-width:400px;">
            <input id="email" type="email" placeholder="E-posta" class="form-control mb-2">
            <input id="password" type="password" placeholder="Şifre" class="form-control mb-2">
            <div class="d-flex gap-2 mb-2">
                <button id="loginBtn" class="btn btn-primary flex-grow-1">Giriş Yap</button>
                <button id="registerBtn" class="btn btn-success flex-grow-1">Kayıt Ol</button>
                <button id="logoutBtn" class="btn btn-outline-danger flex-grow-1">Çıkış Yap</button>
            </div>
            <div id="user-info" style="margin-top:1em; color:green;"></div>
        </div>

        <div class="modal fade" id="premiumModal" tabindex="-1" aria-labelledby="premiumModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="premiumModalLabel"><i class="bi bi-star-fill text-warning"></i> Premium Üyelik</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="premiumLoginForm">
                            <div class="mb-3">
                                <label for="premiumPassword" class="form-label">Premium Şifre</label>
                                <input type="password" class="form-control" id="premiumPassword" placeholder="Premium şifrenizi girin">
                                <small class="form-text text-muted">Deneme şifresi: 1234567890</small>
                            </div>
                            <button id="premiumLoginBtn" class="btn btn-warning w-100">Premium Giriş</button>
                        </div>
                        <div id="premiumInfo" class="d-none">
                            <div class="alert alert-success">
                                <i class="bi bi-check-circle-fill"></i> Premium üyeliğiniz aktif!
                            </div>
                            <h6 class="fw-bold">Premium Avantajları:</h6>
                            <ul>
                                <li>Sınırsız kelime ekleme</li>
                                <li>Özel içerikler</li>
                                <li>Reklamsız deneyim</li>
                                <li>Gelişmiş istatistikler</li>
                            </ul>
                            <button id="premiumLogoutBtn" class="btn btn-outline-danger w-100">Çıkış Yap</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

       

        <div class="d-flex justify-content-center gap-2 mb-4 flex-wrap">
            <button id="hatSanatiBtn" class="btn btn-warning nav-btn" title="Yazı sanatları">
                <i class="bi bi-pen-fill"></i>
            </button>
            <button id="gazetelerBtn" class="btn btn-info nav-btn" title="Osmanlıca Gazeteler">
                <i class="bi bi-newspaper"></i>
            </button>
            <button id="sozlukBtn" class="btn btn-info nav-btn" title="Osmanlıca Sözlük">
                <i class="bi bi-journal-bookmark"></i>
            </button>
            <button id="premiumBtn" class="btn btn-warning nav-btn" title="Premium Üyelik" data-bs-toggle="modal" data-bs-target="#premiumModal">
                <i class="bi bi-star-fill"></i>
            </button>
            <a href="profil.html" id="profileBtn" class="btn btn-secondary nav-btn" title="Profil" aria-label="Profil sayfasına git">
    <i class="bi bi-person-fill"></i>
</a> </button>
            
        </div>

        <div class="card search-card mb-3">
            <div class="card-body">
                <div class="input-group">
                    <input type="text" id="searchInput" class="form-control" placeholder="Kelime ara...">
                    <button id="searchButton" class="btn btn-primary" type="button">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </div>
        </div>

        <main>
            <div class="card word-card mb-3">
                <div class="card-body">
                    <div class="word-display text-center py-3">
                        <h2 id="osmanlicaKelime" class="osmanlica-font">---</h2>
                        <p id="transliteration" class="transliteration">---</p>
                        <p id="meaning" class="meaning">Lütfen kelime listesi yükleyin</p>
                    </div>
                    <div class="d-flex justify-content-center gap-2 mb-4 flex-wrap">
                        <button id="oncekiKelimeBtn" class="btn btn-secondary nav-btn" title="Önceki kelime">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <button id="rastgeleKelimeBtn" class="btn btn-info nav-btn" title="Rastgele kelime">
                            <i class="bi bi-shuffle"></i>
                        </button>
                        <button id="sonrakiKelimeBtn" class="btn btn-secondary nav-btn" title="Sonraki kelime">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                    <div class="knowledge-buttons d-flex justify-content-center gap-3">
                        <button id="bilmiyorumBtn" class="btn btn-danger nav-btn" title="Bilmiyorum">
                            <i class="bi bi-x-circle"></i>
                        </button>
                        <button id="biliyorumBtn" class="btn btn-success nav-btn" title="Biliyorum">
                            <i class="bi bi-check-circle"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="text-center my-3">
                <button id="startQuizBtn" class="btn btn-danger">
                    <i class="bi bi-question-circle"></i> Quiz Başlat
                </button>
            </div>
            
            <div class="modal fade" id="quizModal" tabindex="-1" aria-labelledby="quizModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 id="quizQuestion" class="modal-title"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="quizOptions"></div>
                            <button id="nextQuestionBtn" class="btn btn-info w-100 mt-2" style="display:none;">Sonraki Soru</button>
                            <button id="endQuizBtn" class="btn btn-danger w-100 mt-2" style="display:none;">Quiz Bitir</button>
                            <p id="quizScore" class="mt-3 text-center fw-bold"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card info-card mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <span id="kelimeSayaci" class="badge bg-primary mb-2 mb-md-0">
                            <i class="bi bi-bar-chart"></i> <span class="counter-text">0/0</span>
                        </span>
                        <div>
                            <div id="listeButonlari" class="list-buttons d-inline-flex flex-wrap gap-2">
                                <!-- Liste butonları buraya eklenecek -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card upload-card">
                <div class="card-body">
                    <h5 class="card-title mb-3"><i class="bi bi-file-earmark-arrow-up"></i> Kelime Listesi</h5>
                    <div class="d-flex gap-2 mb-3">
                        <button id="mevcutListeyeEkleBtn" class="btn btn-warning flex-grow-1 nav-btn" title="Mevcut listeye ekle">
                            <i class="bi bi-plus-circle"></i>
                        </button>
                        <button id="yeniListeOlusturBtn" class="btn btn-success flex-grow-1 nav-btn" title="Yeni liste oluştur">
                            <i class="bi bi-file-earmark-plus"></i>
                        </button>
                    </div>
                    <div class="d-flex gap-2 mb-3">
                        <button id="yeniListeEkleBtn" class="btn btn-outline-primary flex-grow-1 nav-btn" title="Boş liste ekle">
                            <i class="bi bi-plus-lg"></i>
                        </button>
                        <button id="listeyiSilBtn" class="btn btn-outline-danger flex-grow-1 nav-btn" title="Listeyi sil">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                    <input type="file" id="jsonFileInput" accept=".json" class="form-control">
                    <div id="wordLimitAlert" class="alert alert-warning mt-2 d-none">
                        <i class="bi bi-exclamation-triangle"></i> Ücretsiz sürümde maksimum 100 kelime ekleyebilirsiniz. Premium üye olun!
                    </div>
                </div>
            </div>
        </main>

        <div class="social-media-bar">
            <a href="https://wa.me/+905309082276" class="social-btn btn btn-success" data-bs-toggle="tooltip" title="WhatsApp">
                <i class="bi bi-whatsapp"></i>
            </a>
            <a href="https://t.me/osmanlicaogren" class="social-btn btn btn-primary" data-bs-toggle="tooltip" title="Telegram">
                <i class="bi bi-telegram"></i>
            </a>
            <a href="mailto:ozzasci@gmail.com" class="social-btn btn btn-danger" data-bs-toggle="tooltip" title="E-mail">
                <i class="bi bi-envelope-fill"></i>
            </a>
            
        </div>

        <div class="d-block d-md-none mt-3">
            <button id="quickSupportBtn" class="btn btn-success w-100 support-btn" data-bs-toggle="modal" data-bs-target="#supportModal">
                <i class="bi bi-heart-fill"></i> Hızlı Destek
            </button>
        </div>

        <footer class="text-center py-2 border-top small">
            © 2025 Osmanlıca Öğren | Tüm Hakları Saklıdır
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    <script>
        // EmailJS başlatma
        (function(){
            emailjs.init("8BdNp7u1PufddSEM8");
        })();

        // Firebase yapılandırması
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-bucket.appspot.com",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Firebase'i başlat
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Auth durum listener'ı
        auth.onAuthStateChanged(user => {
            window.currentUser = user;
            if (user) {
                document.getElementById('user-info').textContent = `Hoş geldiniz, ${user.email}`;
                document.getElementById('auth-section').classList.add('d-none');
            } else {
                document.getElementById('user-info').textContent = '';
                document.getElementById('auth-section').classList.remove('d-none');
            }
            if (window.osmanlicaUygulamasi) {
                window.osmanlicaUygulamasi.firebaseReady();
            }
        });

        // Auth fonksiyonları
        document.getElementById('loginBtn').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then(() => alert('Giriş başarılı!'))
                .catch(error => alert('Giriş hatası: ' + error.message));
        });

        document.getElementById('registerBtn').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => alert('Kayıt başarılı!'))
                .catch(error => alert('Kayıt hatası: ' + error.message));
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            auth.signOut()
                .then(() => alert('Çıkış yapıldı'))
                .catch(error => alert('Çıkış hatası: ' + error.message));
        });
    </script>
    <script>
        // Uygulama ana kodu
        class OsmanlicaUygulamasi {
            constructor() {
                this.elements = {
                    osmanlicaKelime: document.getElementById('osmanlicaKelime'),
                    transliteration: document.getElementById('transliteration'),
                    meaning: document.getElementById('meaning'),
                    kelimeSayaci: document.querySelector('.counter-text'),
                    oncekiKelimeBtn: document.getElementById('oncekiKelimeBtn'),
                    sonrakiKelimeBtn: document.getElementById('sonrakiKelimeBtn'),
                    rastgeleKelimeBtn: document.getElementById('rastgeleKelimeBtn'),
                    bilmiyorumBtn: document.getElementById('bilmiyorumBtn'),
                    biliyorumBtn: document.getElementById('biliyorumBtn'),
                    listeButonlari: document.getElementById('listeButonlari'),
                    yeniListeEkleBtn: document.getElementById('yeniListeEkleBtn'),
                    listeyiSilBtn: document.getElementById('listeyiSilBtn'),
                    jsonFileInput: document.getElementById('jsonFileInput'),
                    mevcutListeyeEkleBtn: document.getElementById('mevcutListeyeEkleBtn'),
                    yeniListeOlusturBtn: document.getElementById('yeniListeOlusturBtn'),
                    themeButtons: document.querySelectorAll('.theme-btn'),
                    premiumBtn: document.getElementById('premiumBtn'),
                    premiumModal: new bootstrap.Modal(document.getElementById('premiumModal')),
                    premiumPassword: document.getElementById('premiumPassword'),
                    premiumLoginBtn: document.getElementById('premiumLoginBtn'),
                    premiumLogoutBtn: document.getElementById('premiumLogoutBtn'),
                    premiumLoginForm: document.getElementById('premiumLoginForm'),
                    premiumInfo: document.getElementById('premiumInfo'),
                    premiumBadge: document.getElementById('premiumBadge'),
                    wordLimitAlert: document.getElementById('wordLimitAlert'),
                    searchInput: document.getElementById('searchInput'),
                    searchButton: document.getElementById('searchButton'),
                    startQuizBtn: document.getElementById('startQuizBtn'),
                    quizModal: new bootstrap.Modal(document.getElementById('quizModal')),
                    quizQuestion: document.getElementById('quizQuestion'),
                    quizOptions: document.getElementById('quizOptions'),
                    quizScore: document.getElementById('quizScore'),
                    nextQuestionBtn: document.getElementById('nextQuestionBtn'),
                    endQuizBtn: document.getElementById('endQuizBtn'),
                    supportModal: new bootstrap.Modal(document.getElementById('supportModal')),
                    supportForm: document.getElementById('supportForm'),
                    supportName: document.getElementById('supportName'),
                    supportEmail: document.getElementById('supportEmail'),
                    supportMessage: document.getElementById('supportMessage'),
                    supportSubmitBtn: document.getElementById('supportSubmitBtn'),
                    supportSubmitText: document.getElementById('supportSubmitText'),
                    supportSpinner: document.getElementById('supportSpinner'),
                    supportAlert: document.getElementById('supportAlert'),
                    quickSupportBtn: document.getElementById('quickSupportBtn')
                };

                this.kelimeListeleri = {};
                this.aktifListeAdi = null;
                this.suankiKelimeIndex = 0;
                this.filteredKelimeler = [];
                this.premium = false;
                this.quizWords = [];
                this.currentQuizIndex = 0;
                this.quizScore = 0;
                this.quizTotal = 0;
                this.eventListeners = new Map();

                this.config = {
                    freeWordLimit: 100,
                    premiumPassword: "1234567890",
                    emailJsServiceId: 'service_1avrv0q',
                    emailJsTemplateId: 'template_pc99ct6',
                    emailJsUserId: '8BdNp7u1PufddSEM8'
                };

                // Kritik elementleri kontrol et
                const requiredElements = ['osmanlicaKelime', 'transliteration', 'meaning', 'kelimeSayaci'];
                for (const el of requiredElements) {
                    if (!this.elements[el]) {
                        console.error(`Gerekli element ${el} DOM'da bulunamadı`);
                        this.showAlert(`Uygulama başlatılamadı: ${el} elementi eksik.`, 'danger');
                        return;
                    }
                }

                this.init();
            }

            async init() {
                try {
                    this.temaYukle();
                    this.eventListenerlariAyarla();
                    this.setupModalAccessibility();
                    await this.firebaseReady();
                    this.updatePremiumUI();
                } catch (error) {
                    console.error('Başlatma hatası:', error);
                    this.showAlert('Uygulama başlatılırken bir hata oluştu.', 'danger');
                }
            }

            setupModalAccessibility() {
                const modals = document.querySelectorAll('.modal');
                const focusableSelector = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]), [contenteditable="true"]';

                modals.forEach(modal => {
                    const modalId = modal.id;
                    const closeButtons = modal.querySelectorAll('[data-bs-dismiss="modal"], .btn-close');
                    const openButtons = document.querySelectorAll(`[data-bs-toggle="modal"][data-bs-target="#${modalId}"]`);

                    if (!modal.classList.contains('show')) {
                        modal.setAttribute('aria-hidden', 'true');
                        modal.style.pointerEvents = 'none';
                    }

                    const shownHandler = () => {
                        modal.setAttribute('aria-hidden', 'false');
                        modal.style.pointerEvents = 'auto';
                        const focusableElements = modal.querySelectorAll(focusableSelector);
                        if (focusableElements.length > 0) {
                            focusableElements[0].focus();
                        }
                    };

                    const hideHandler = () => {
                        let focusTarget = openButtons.length > 0 ? openButtons[0] : document.body;
                        openButtons.forEach(button => {
                            if (button.getAttribute('aria-expanded') === 'true') {
                                focusTarget = button;
                            }
                        });
                        focusTarget.focus();

                        setTimeout(() => {
                            modal.setAttribute('aria-hidden', 'true');
                            modal.style.pointerEvents = 'none';
                            const keydownHandler = this.eventListeners.get(`modal-keydown-${modalId}`);
                            if (keydownHandler) {
                                modal.removeEventListener('keydown', keydownHandler);
                                this.eventListeners.delete(`modal-keydown-${modalId}`);
                            }
                        }, 0);
                    };

                    const keydownHandler = (e) => {
                        if (e.key === 'Tab') {
                            const focusableContent = modal.querySelectorAll(focusableSelector);
                            const first = focusableContent[0];
                            const last = focusableContent[focusableContent.length - 1];

                            if (e.shiftKey && document.activeElement === first) {
                                last.focus();
                                e.preventDefault();
                            } else if (!e.shiftKey && document.activeElement === last) {
                                first.focus();
                                e.preventDefault();
                            }
                        } else if (e.key === 'Escape') {
                            const modalInstance = bootstrap.Modal.getInstance(modal);
                            if (modalInstance) modalInstance.hide();
                        }
                    };

                    modal.addEventListener('shown.bs.modal', shownHandler);
                    modal.addEventListener('hide.bs.modal', hideHandler);
                    modal.addEventListener('keydown', keydownHandler);
                    this.eventListeners.set(`modal-shown-${modalId}`, shownHandler);
                    this.eventListeners.set(`modal-hide-${modalId}`, hideHandler);
                    this.eventListeners.set(`modal-keydown-${modalId}`, keydownHandler);

                    closeButtons.forEach((button, index) => {
                        const clickHandler = () => {
                            const modalInstance = bootstrap.Modal.getInstance(modal);
                            if (modalInstance) modalInstance.hide();
                        };
                        button.addEventListener('click', clickHandler);
                        this.eventListeners.set(`modal-close-${modalId}-${button.id || index}`, clickHandler);
                    });
                });

                if (this.elements.premiumModal) {
                    const premiumShownHandler = () => {
                        if (this.elements.premiumPassword) {
                            this.elements.premiumPassword.focus();
                        }
                    };
                    this.elements.premiumModal._element.addEventListener('shown.bs.modal', premiumShownHandler);
                    this.eventListeners.set('premium-modal-shown', premiumShownHandler);
                }

                if (this.elements.supportModal) {
                    const supportShownHandler = () => {
                        if (this.elements.supportName) {
                            this.elements.supportName.focus();
                        } else {
                            const closeButton = this.elements.supportModal._element.querySelector('.btn-close');
                            if (closeButton) closeButton.focus();
                        }
                    };
                    this.elements.supportModal._element.addEventListener('shown.bs.modal', supportShownHandler);
                    this.eventListeners.set('support-modal-shown', supportShownHandler);

                    const supportHideHandler = () => {
                        const focusTarget = document.querySelector('.support-btn') || document.body;
                        focusTarget.focus();
                        this.resetSupportForm();
                    };
                    this.elements.supportModal._element.addEventListener('hide.bs.modal', supportHideHandler);
                    this.eventListeners.set('support-modal-hide', supportHideHandler);
                }

                if (this.elements.quizModal) {
                    const quizShownHandler = () => {
                        const firstOption = this.elements.quizModal._element.querySelector('.quiz-option');
                        if (firstOption) {
                            firstOption.focus();
                        } else {
                            const closeButton = this.elements.quizModal._element.querySelector('.btn-close');
                            if (closeButton) closeButton.focus();
                        }
                    };
                    this.elements.quizModal._element.addEventListener('shown.bs.modal', quizShownHandler);
                    this.eventListeners.set('quiz-modal-shown', quizShownHandler);

                    const quizHideHandler = () => {
                        this.resetQuiz();
                        const focusTarget = this.elements.startQuizBtn || document.body;
                        focusTarget.focus();
                    };
                    this.elements.quizModal._element.addEventListener('hide.bs.modal', quizHideHandler);
                    this.eventListeners.set('quiz-modal-hide', quizHideHandler);
                }
            }

            resetSupportForm() {
                if (this.elements.supportForm) this.elements.supportForm.reset();
                if (this.elements.supportAlert) {
                    this.elements.supportAlert.classList.add('d-none');
                    this.elements.supportAlert.innerHTML = '';
                }
                if (this.elements.supportSubmitBtn) this.elements.supportSubmitBtn.disabled = false;
                if (this.elements.supportSpinner) this.elements.supportSpinner.classList.add('d-none');
                if (this.elements.supportSubmitText) this.elements.supportSubmitText.textContent = 'Gönder';
            }

            async firebaseReady() {
                if (!window.firebase || !window.firebase.auth) {
                    console.error('Firebase başlatılamadı');
                    this.showAlert('Firebase başlatılamadı. Lütfen bağlantınızı kontrol edin.', 'danger');
                    return;
                }

                if (!window.currentUser) {
                    this.kelimeListeleri = {};
                    this.aktifListeAdi = null;
                    this.listeButonlariniGuncelle();
                    this.kelimeGoster();
                    this.premium = false;
                    this.updatePremiumUI();
                    return;
                }

                try {
                    await this.loadUserPremium();
                    await this.firestoreListeleriYukle();
                } catch (error) {
                    console.error('Firebase başlatma hatası:', error);
                    this.showAlert('Veriler yüklenirken hata oluştu.', 'danger');
                }
            }

            async loadUserPremium() {
                if (!window.currentUser || !window.firebase.firestore) return;
                try {
                    const userDoc = await db.collection("users").doc(window.currentUser.uid).get();
                    this.premium = userDoc.exists && userDoc.data().premium;
                    this.updatePremiumUI();
                } catch (error) {
                    console.error('Premium durum yükleme hatası:', error);
                    this.showAlert('Premium durum kontrolü başarısız.', 'danger');
                }
            }

            updatePremiumUI() {
                if (this.elements.premiumBadge) {
                    this.elements.premiumBadge.classList.toggle('d-none', !this.premium);
                }
                if (this.elements.premiumInfo) {
                    this.elements.premiumInfo.classList.toggle('d-none', !this.premium);
                }
                if (this.elements.premiumLoginForm) {
                    this.elements.premiumLoginForm.classList.toggle('d-none', this.premium);
                }
                if (this.elements.premiumLogoutBtn) {
                    this.elements.premiumLogoutBtn.classList.toggle('d-none', !this.premium);
                }
            }

            async firestoreListeleriYukle() {
                const user = window.currentUser;
                if (!user || !window.firebase.firestore) return;
                try {
                    const snapshot = await db.collection("users").doc(user.uid).collection("kelimeListeleri").get();
                    this.kelimeListeleri = {};
                    snapshot.forEach(doc => {
                        this.kelimeListeleri[doc.id] = doc.data().kelimeler || [];
                    });
                    this.aktifListeAdi = Object.keys(this.kelimeListeleri)[0] || null;
                    this.listeButonlariniGuncelle();
                    this.kelimeGoster();
                } catch (error) {
                    console.error('Kelime listeleri yükleme hatası:', error);
                    this.showAlert('Kelime listeleri yüklenemedi.', 'danger');
                }
            }

            async firestoreListeKaydet(listeAdi) {
                const user = window.currentUser;
                if (!user || !window.firebase.firestore) return;
                try {
                    const kelimeler = this.kelimeListeleri[listeAdi] || [];
                    await db.collection("users").doc(user.uid).collection("kelimeListeleri").doc(listeAdi).set({ kelimeler });
                } catch (error) {
                    console.error('Liste kaydetme hatası:', error);
                    this.showAlert('Liste kaydedilemedi.', 'danger');
                }
            }

            async firestoreListeSil(listeAdi) {
                const user = window.currentUser;
                if (!user || !window.firebase.firestore) return;
                try {
                    await db.collection("users").doc(user.uid).collection("kelimeListeleri").doc(listeAdi).delete();
                } catch (error) {
                    console.error('Liste silme hatası:', error);
                    this.showAlert('Liste silinemedi.', 'danger');
                }
            }

            temaYukle() {
                const savedTheme = localStorage.getItem('osmanlicaTheme') || 'light';
                this.temaDegistir(savedTheme);
            }

            temaDegistir(theme) {
                if (!document.body) return;
                document.body.className = `${theme}-theme`;
                localStorage.setItem('osmanlicaTheme', theme);
                this.elements.themeButtons.forEach(btn => {
                    if (btn.dataset.theme) {
                        btn.classList.toggle('active', btn.dataset.theme === theme);
                    }
                });
            }

            listeButonlariniGuncelle() {
                if (!this.elements.listeButonlari) return;
                this.elements.listeButonlari.innerHTML = '';
                Object.keys(this.kelimeListeleri).forEach(listeAdi => {
                    const btn = document.createElement('button');
                    btn.className = `btn btn-sm ${listeAdi === this.aktifListeAdi ? 'btn-primary' : 'btn-outline-secondary'}`;
                    btn.textContent = listeAdi;
                    btn.setAttribute('aria-label', `${listeAdi} listesini seç`);
                    const clickHandler = () => this.aktifListeDegistir(listeAdi);
                    btn.addEventListener('click', clickHandler);
                    btn.dataset.listeAdi = listeAdi;
                    this.eventListeners.set(`liste-btn-${listeAdi}`, clickHandler);
                    this.elements.listeButonlari.appendChild(btn);
                });
            }

            aktifListeDegistir(listeAdi) {
                this.aktifListeAdi = listeAdi;
                this.suankiKelimeIndex = 0;
                this.filteredKelimeler = [];
                this.listeButonlariniGuncelle();
                this.kelimeGoster();
            }

            aktifKelimeler() {
                return this.filteredKelimeler.length > 0 ? 
                    this.filteredKelimeler : 
                    (this.aktifListeAdi ? this.kelimeListeleri[this.aktifListeAdi] || [] : []);
            }

            kelimeGoster(isFiltered = false) {
                if (!this.elements.osmanlicaKelime || !this.elements.transliteration || !this.elements.meaning) return;

                const kelimeler = isFiltered ? this.filteredKelimeler : this.aktifKelimeler();

                if (kelimeler.length === 0) {
                    this.elements.osmanlicaKelime.textContent = '---';
                    this.elements.transliteration.textContent = '---';
                    this.elements.meaning.textContent = isFiltered ? 'Sonuç bulunamadı' : (this.aktifListeAdi ? 'Liste boş' : 'Liste yükleyin');
                    this.guncelleKelimeSayaci();
                    return;
                }

                const kelime = kelimeler[this.suankiKelimeIndex];

                [this.elements.osmanlicaKelime, this.elements.transliteration, this.elements.meaning]
                    .forEach(el => el.style.opacity = 0);

                setTimeout(() => {
                    this.elements.osmanlicaKelime.textContent = kelime.word || '---';
                    this.elements.transliteration.textContent = kelime.transliteration || '---';
                    this.elements.meaning.textContent = kelime.meaning || '---';

                    [this.elements.osmanlicaKelime, this.elements.transliteration, this.elements.meaning]
                        .forEach(el => el.style.opacity = 1);

                    this.guncelleKelimeSayaci();
                }, 200);
            }

            guncelleKelimeSayaci() {
                if (!this.elements.kelimeSayaci) return;
                const kelimeler = this.aktifKelimeler();
                this.elements.kelimeSayaci.textContent = 
                    `${kelimeler.length ? this.suankiKelimeIndex + 1 : 0}/${kelimeler.length}`;
            }

            oncekiKelime() {
                const kelimeler = this.aktifKelimeler();
                if (!kelimeler.length) return;
                this.suankiKelimeIndex = (this.suankiKelimeIndex - 1 + kelimeler.length) % kelimeler.length;
                this.kelimeGoster(this.filteredKelimeler.length > 0);
            }

            sonrakiKelime() {
                const kelimeler = this.aktifKelimeler();
                if (!kelimeler.length) return;
                this.suankiKelimeIndex = (this.suankiKelimeIndex + 1) % kelimeler.length;
                this.kelimeGoster(this.filteredKelimeler.length > 0);
            }

            rastgeleKelime() {
                const kelimeler = this.aktifKelimeler();
                if (kelimeler.length < 2) return;

                let yeniIndex;
                do {
                    yeniIndex = Math.floor(Math.random() * kelimeler.length);
                } while (yeniIndex === this.suankiKelimeIndex);

                this.suankiKelimeIndex = yeniIndex;
                this.kelimeGoster(this.filteredKelimeler.length > 0);
            }

            kelimeAra() {
                if (!this.elements.searchInput) return;
                const searchTerm = this.elements.searchInput.value.toLowerCase().trim();
                if (!searchTerm) {
                    this.filteredKelimeler = [];
                    this.suankiKelimeIndex = 0;
                    this.kelimeGoster();
                    return;
                }

                const kelimeler = this.aktifListeAdi ? this.kelimeListeleri[this.aktifListeAdi] || [] : [];
                this.filteredKelimeler = kelimeler.filter(kelime =>
                    (kelime.word?.toLowerCase().includes(searchTerm)) ||
                    (kelime.transliteration?.toLowerCase().includes(searchTerm)) ||
                    (kelime.meaning?.toLowerCase().includes(searchTerm))
                );

                if (this.filteredKelimeler.length > 0) {
                    this.suankiKelimeIndex = 0;
                    this.kelimeGoster(true);
                } else {
                    this.showAlert('Aranan kelime bulunamadı', 'warning');
                }
            }

            async jsonDosyasiniIsle(file, mevcutListeyeEkle) {
                if (!file || !this.elements.jsonFileInput) return;
                if (this.checkWordLimit()) {
                    if (this.elements.premiumModal) this.elements.premiumModal.show();
                    return;
                }

                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const yeniKelimeler = JSON.parse(e.target.result);
                        if (!Array.isArray(yeniKelimeler)) throw new Error('Geçersiz JSON formatı');

                        const gecerliKelimeler = yeniKelimeler.filter(k => k?.word && k?.meaning);
                        if (!gecerliKelimeler.length) throw new Error('Geçerli kelime bulunamadı');

                        let listeAdi = this.aktifListeAdi;
                        if (!mevcutListeyeEkle || !listeAdi) {
                            listeAdi = file.name.replace('.json', '') || 'Yeni Liste';
                            this.kelimeListeleri[listeAdi] = gecerliKelimeler;
                            this.aktifListeAdi = listeAdi;
                        } else {
                            this.kelimeListeleri[listeAdi] = [
                                ...(this.kelimeListeleri[listeAdi] || []),
                                ...gecerliKelimeler
                            ];
                        }

                        await this.firestoreListeKaydet(listeAdi);
                        this.listeButonlariniGuncelle();
                        this.kelimeGoster();

                        this.showAlert(`${gecerliKelimeler.length} kelime başarıyla yüklendi!`, 'success');
                    } catch (error) {
                        console.error('JSON işleme hatası:', error);
                        this.showAlert(`Hata: ${error.message}`, 'danger');
                    }
                };
                reader.readAsText(file);
            }

            checkWordLimit() {
                if (this.premium) return false;
                const limitAsildi = this.getTotalWordCount() >= this.config.freeWordLimit;
                if (this.elements.wordLimitAlert) {
                    this.elements.wordLimitAlert.classList.toggle('d-none', !limitAsildi);
                }
                return limitAsildi;
            }

            getTotalWordCount() {
                return Object.values(this.kelimeListeleri).reduce((sum, liste) => sum + liste.length, 0);
            }

            showAlert(message, type) {
                const container = document.querySelector('.container');
                if (!container) return;
                const alert = document.createElement('div');
                alert.className = `alert alert-${type} alert-dismissible fade show`;
                alert.setAttribute('role', 'alert');
                alert.innerHTML = `${message}<button class="btn-close" data-bs-dismiss="alert" aria-label="Kapat"></button>`;
                container.prepend(alert);
                setTimeout(() => alert.remove(), 3000);
            }

            startQuiz() {
                if (!this.elements.quizModal) return;
                const kelimeler = this.aktifKelimeler();
                if (kelimeler.length < 4) {
                    this.showAlert('Quiz için en az 4 kelime olmalı!', 'warning');
                    return;
                }
                this.quizWords = this.shuffleArray([...kelimeler]);
                this.currentQuizIndex = 0;
                this.quizScore = 0;
                this.quizTotal = Math.min(this.quizWords.length, 10);
                this.elements.quizModal.show();
                this.showQuizQuestion();
            }

            showQuizQuestion() {
                if (!this.elements.quizModal || !this.elements.quizQuestion || !this.elements.quizOptions) return;

                if (this.currentQuizIndex >= this.quizTotal) {
                    this.elements.quizQuestion.textContent = 'Quiz Bitti!';
                    this.elements.quizOptions.innerHTML = '';
                    this.elements.quizScore.textContent = `Doğru: ${this.quizScore}/${this.quizTotal}`;
                    if (this.elements.endQuizBtn) this.elements.endQuizBtn.style.display = 'block';
                    if (this.elements.nextQuestionBtn) this.elements.nextQuestionBtn.style.display = 'none';
                    return;
                }

                const currentWord = this.quizWords[this.currentQuizIndex];
                const correct = currentWord.meaning;
                let options = [correct];
                while (options.length < 4) {
                    const wrong = this.quizWords[Math.floor(Math.random() * this.quizWords.length)].meaning;
                    if (!options.includes(wrong)) options.push(wrong);
                }
                options = this.shuffleArray(options);

                this.elements.quizQuestion.textContent = `"${currentWord.word}" (${currentWord.transliteration}) kelimesinin Türkçesi nedir?`;
                this.elements.quizOptions.innerHTML = options.map((opt, index) => 
                    `<button class="quiz-option btn btn-outline-primary w-100 my-1" role="button" aria-label="Seçenek ${index + 1}: ${opt}">${opt}</button>`
                ).join('');

                const optionButtons = this.elements.quizOptions.querySelectorAll('.quiz-option');
                optionButtons.forEach((btn, index) => {
                    const clickHandler = () => {
                        if (btn.textContent === correct) {
                            this.quizScore++;
                            btn.classList.remove('btn-outline-primary');
                            btn.classList.add('btn-success');
                        } else {
                            btn.classList.remove('btn-outline-primary');
                            btn.classList.add('btn-danger');
                        }
                        optionButtons.forEach(b => b.disabled = true);
                        if (this.elements.nextQuestionBtn) this.elements.nextQuestionBtn.style.display = 'inline-block';
                    };
                    btn.addEventListener('click', clickHandler);
                    this.eventListeners.set(`quiz-option-${this.currentQuizIndex}-${index}`, clickHandler);
                });

                if (this.elements.nextQuestionBtn) this.elements.nextQuestionBtn.style.display = 'none';
                if (this.elements.endQuizBtn) this.elements.endQuizBtn.style.display = 'none';
            }

            nextQuestion() {
                this.currentQuizIndex++;
                this.showQuizQuestion();
            }

            endQuiz() {
                if (this.elements.quizModal) this.elements.quizModal.hide();
            }

            resetQuiz() {
                this.quizWords = [];
                this.currentQuizIndex = 0;
                this.quizScore = 0;
                this.quizTotal = 0;
                if (this.elements.quizQuestion) this.elements.quizQuestion.textContent = '';
                if (this.elements.quizOptions) this.elements.quizOptions.innerHTML = '';
                if (this.elements.quizScore) this.elements.quizScore.textContent = '';
                if (this.elements.nextQuestionBtn) this.elements.nextQuestionBtn.style.display = 'none';
                if (this.elements.endQuizBtn) this.elements.endQuizBtn.style.display = 'none';
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            async handleSupportForm(e) {
                e.preventDefault();
                if (!this.elements.supportForm || !this.elements.supportSubmitBtn || !this.elements.supportSubmitText || !this.elements.supportSpinner || !this.elements.supportAlert) return;

                this.elements.supportSubmitBtn.disabled = true;
                this.elements.supportSubmitText.textContent = 'Gönderiliyor...';
                this.elements.supportSpinner.classList.remove('d-none');
                this.elements.supportAlert.classList.add('d-none');

                try {
                    if (!window.emailjs) throw new Error('EmailJS yüklenemedi.');
                    const formData = {
                        name: this.elements.supportName.value.trim(),
                        email: this.elements.supportEmail.value.trim(),
                        message: this.elements.supportMessage.value.trim(),
                        app_name: 'Osmanlıca Öğren'
                    };

                    if (!formData.name || !formData.email || !formData.message) {
                        throw new Error('Lütfen tüm alanları doldurun.');
                    }

                    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) {
                        throw new Error('Geçerli bir e-posta adresi girin.');
                    }

                    await emailjs.send(
                        this.config.emailJsServiceId,
                        this.config.emailJsTemplateId,
                        formData,
                        this.config.emailJsUserId
                    );

                    this.elements.supportAlert.classList.remove('alert-danger');
                    this.elements.supportAlert.classList.add('alert-success');
                    this.elements.supportAlert.innerHTML = `
                        <i class="bi bi-check-circle"></i> 
                        Mesajınız başarıyla gönderildi! Teşekkür ederiz.
                    `;
                    this.elements.supportAlert.classList.remove('d-none');

                    this.elements.supportForm.reset();

                    setTimeout(() => {
                        if (this.elements.supportModal) this.elements.supportModal.hide();
                    }, 2000);
                } catch (error) {
                    console.error('Destek formu gönderim hatası:', error);
                    this.elements.supportAlert.classList.remove('alert-success');
                    this.elements.supportAlert.classList.add('alert-danger');
                    this.elements.supportAlert.innerHTML = `
                        <i class="bi bi-exclamation-triangle"></i> 
                        ${error.message || 'Gönderim hatası. Lütfen daha sonra tekrar deneyin.'}
                    `;
                    this.elements.supportAlert.classList.remove('d-none');
                } finally {
                    this.elements.supportSubmitText.textContent = 'Gönder';
                    this.elements.supportSpinner.classList.add('d-none');
                    this.elements.supportSubmitBtn.disabled = false;
                }
            }

            eventListenerlariAyarla() {
                this.elements.themeButtons.forEach(btn => {
                    if (!btn.dataset.theme) return;
                    const clickHandler = () => this.temaDegistir(btn.dataset.theme);
                    btn.addEventListener('click', clickHandler);
                    this.eventListeners.set(`theme-btn-${btn.dataset.theme}`, clickHandler);
                });

                const buttonListeners = [
                    { element: this.elements.oncekiKelimeBtn, handler: () => this.oncekiKelime(), id: 'oncekiKelimeBtn' },
                    { element: this.elements.sonrakiKelimeBtn, handler: () => this.sonrakiKelime(), id: 'sonrakiKelimeBtn' },
                    { element: this.elements.rastgeleKelimeBtn, handler: () => this.rastgeleKelime(), id: 'rastgeleKelimeBtn' },
                    { element: this.elements.bilmiyorumBtn, handler: () => {
                        this.showAlert('Bu kelimeyi bilmediğiniz işaretlendi!', 'warning');
                        this.sonrakiKelime();
                    }, id: 'bilmiyorumBtn' },
                    { element: this.elements.biliyorumBtn, handler: () => {
                        this.showAlert('Harika! Bu kelimeyi biliyorsunuz!', 'success');
                        this.sonrakiKelime();
                    }, id: 'biliyorumBtn' },
                    { element: this.elements.yeniListeEkleBtn, handler: async () => {
                        const listeAdi = prompt('Yeni liste adı girin:');
                        if (!listeAdi) return;

                        if (this.kelimeListeleri[listeAdi]) {
                            this.showAlert('Bu isimde liste zaten var!', 'warning');
                            return;
                        }

                        this.kelimeListeleri[listeAdi] = [];
                        this.aktifListeAdi = listeAdi;
                        await this.firestoreListeKaydet(listeAdi);
                        this.listeButonlariniGuncelle();
                        this.kelimeGoster();
                    }, id: 'yeniListeEkleBtn' },
                    { element: this.elements.listeyiSilBtn, handler: async () => {
                        if (!this.aktifListeAdi) return;
                        if (confirm(`"${this.aktifListeAdi}" listesini silmek istediğinize emin misiniz?`)) {
                            await this.firestoreListeSil(this.aktifListeAdi);
                            delete this.kelimeListeleri[this.aktifListeAdi];
                            this.aktifListeAdi = Object.keys(this.kelimeListeleri)[0] || null;
                            this.listeButonlariniGuncelle();
                            this.kelimeGoster();
                        }
                    }, id: 'listeyiSilBtn' },
                    { element: this.elements.mevcutListeyeEkleBtn, handler: () => {
                        if (!this.elements.jsonFileInput?.files[0]) {
                            this.showAlert('Lütfen bir JSON dosyası seçin!', 'warning');
                            return;
                        }
                        this.jsonDosyasiniIsle(this.elements.jsonFileInput.files[0], true);
                    }, id: 'mevcutListeyeEkleBtn' },
                    { element: this.elements.yeniListeOlusturBtn, handler: () => {
                        if (!this.elements.jsonFileInput?.files[0]) {
                            this.showAlert('Lütfen bir JSON dosyası seçin!', 'warning');
                            return;
                        }
                        this.jsonDosyasiniIsle(this.elements.jsonFileInput.files[0], false);
                    }, id: 'yeniListeOlusturBtn' },
                    { element: this.elements.searchButton, handler: () => this.kelimeAra(), id: 'searchButton' },
                    { element: this.elements.startQuizBtn, handler: () => this.startQuiz(), id: 'startQuizBtn' },
                    { element: this.elements.nextQuestionBtn, handler: () => this.nextQuestion(), id: 'nextQuestionBtn' },
                    { element: this.elements.endQuizBtn, handler: () => this.endQuiz(), id: 'endQuizBtn' },
                    { element: this.elements.premiumLoginBtn, handler: () => {
                        if (this.elements.premiumPassword.value === this.config.premiumPassword) {
                            this.premium = true;
                            if (window.currentUser) {
                                db.collection("users").doc(window.currentUser.uid).set({ premium: true }, { merge: true });
                            }
                            this.updatePremiumUI();
                            this.showAlert('Premium üyeliğiniz aktif edildi!', 'success');
                            this.elements.premiumModal.hide();
                        } else {
                            this.showAlert('Geçersiz premium şifre!', 'warning');
                        }
                    }, id: 'loginBtn'},
                    { element: this.elements.premiumLogoutBtn, handler: () => {
                        this.premium = false;
                        if (window.currentUser) {
                            db.collection("users").doc(window.currentUser.uid).set({ premium: false }, { merge: true });
                        }
                        this.updatePremiumUI();
                        this.showAlert('Premium üyeliğiniz sonlandırıldı.', 'warning');
                    }, id: 'premiumLogoutBtn' }
                ];

                buttonListeners.forEach(({ element, handler, id }) => {
                    if (element) {
                        element.addEventListener('click', handler);
                        this.eventListeners.set(`click-${id}`, handler);
                    }
                });

                if (this.elements.searchInput) {
                    const keyupHandler = (e) => {
                        if (e.key === 'Enter') this.kelimeAra();
                    };
                    this.elements.searchInput.addEventListener('keyup', keyupHandler);
                    this.eventListeners.set('searchInput-keyup', keyupHandler);
                }

                if (this.elements.jsonFileInput) {
                    const changeHandler = (e) => {
                        if (e.target.files.length) this.jsonDosyasiniIsle(e.target.files[0], false);
                    };
                    this.elements.jsonFileInput.addEventListener('change', changeHandler);
                    this.eventListeners.set('jsonFileInput-change', changeHandler);
                }

                if (this.elements.supportForm) {
                    const submitHandler = (e) => this.handleSupportForm(e);
                    this.elements.supportForm.addEventListener('submit', submitHandler);
                    this.eventListeners.set('supportForm-submit', submitHandler);
                }

                document.querySelectorAll('.support-btn').forEach(btn => {
                    const clickHandler = (e) => {
                        e.preventDefault();
                        if (this.elements.supportModal) {
                            this.elements.supportModal.show();
                        }
                    };
                    btn.addEventListener('click', clickHandler);
                    this.eventListeners.set(`support-btn-${btn.id || Math.random()}`, clickHandler);
                });
            }

            cleanup() {
                this.eventListeners.forEach((handler, key) => {
                    const [type, id] = key.split('-');
                    let element;
                    if (type === 'modal') {
                        element = document.getElementById(id);
                    } else if (type === 'theme-btn') {
                        element = document.querySelector(`.theme-btn[data-theme="${id}"]`);
                    } else if (type === 'liste-btn') {
                        element = this.elements.listeButonlari?.querySelector(`button[data-liste-adi="${id}"]`);
                    } else if (type === 'quiz-option') {
                        element = this.elements.quizOptions?.querySelector(`.quiz-option:nth-child(${parseInt(id.split('-').pop()) + 1})`);
                    } else if (type === 'click') {
                        element = document.getElementById(id);
                    } else if (type === 'submit') {
                        element = this.elements[id];
                    } else {
                        element = this.elements[id];
                    }
                    if (element) {
                        element.removeEventListener('click', handler);
                        element.removeEventListener('keydown', handler);
                        element.removeEventListener('keyup', handler);
                        element.removeEventListener('submit', handler);
                    }
                });
                this.eventListeners.clear();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            try {
                window.osmanlicaUygulamasi = new OsmanlicaUygulamasi();
            } catch (error) {
                console.error('OsmanlicaUygulamasi başlatılamadı:', error);
                const container = document.querySelector('.container');
                if (container) {
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-danger alert-dismissible fade show';
                    alert.setAttribute('role', 'alert');
                    alert.innerHTML = `Hata: ${error.message}<button class="btn-close" data-bs-dismiss="alert" aria-label="Kapat"></button>`;
                    container.prepend(alert);
                }
            }
        });
    </script>
</body>
</html>
